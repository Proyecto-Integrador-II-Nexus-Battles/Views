<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="/img/icon.png" type="image/x-icon">
  <title>Subasta</title>
  <link rel="stylesheet" href="/subasta/css/subasta.css">
  <link rel="stylesheet" href="/templates/css/navbarFeatureCSS.css">
</head>



<body>
<header>
  <nav>
    <%- include('../../templates/navbarEcommerce'); %>
  </nav>
</header>
<main class="container_general">
  <img class="back_img" src="/vitrina_productos/img/Vector.png">

  <% // Mapeo de subtipos a imágenes y tipo de icono
  const subtipoImagen = {
    "Armas": "/inventario/imagenes/espadas.png",
    "Tanque": "/inventario/imagenes/blindaje.png",
    "Fuego": "/inventario/imagenes/Fuego.png",
    "Hielo": "/inventario/imagenes/hielo.png",
    "Veneno": "/inventario/imagenes/veneno.png",
    "Machete": "/inventario/imagenes/machete.png"
  };

  for (let i = 0; i < datos.length; i++) {
    const carta = datos[i];
    const imagen = subtipoImagen[carta.Subtype];
    const pujas = carta.PUJAS;

    %>

<!-- Informacion y foto de la carta -->
  <div class="info_carta">
    <img src="<%= carta.imagePath %>" alt="">
    <p class="nombre_carta"><b><%= carta.Name %></b></p>
   <ul class="detalles_card">
    <li class="tipo"><b>Tipo carta:</b>&nbsp <%= carta.Type %></li>
    <li class="description"><b>Descripción:</b>&nbsp <%= carta.Description %></li>
   </ul>
  </div>
   <!-- Informacion de la subasta -->
<div class="subasta_info">
<h2 class="subasta_info_title">Información de la subasta</h2>
<div class="valor_base_subasta">
  <p><b>Valor base</b></p>
  <p><b>Créditos: </b><%= carta.CREDITOS_MIN %></p>
  <% if (carta.CARTAS_MIN !== null ) { %>
  <p><b>Cartas:</b></p>
  <ul class="cartas_v_max">
    <li><%= carta.CARTAS_MIN %></li>
  </ul>
  <% } %>
</div>

<div class="valor_maximo_subasta">
  <p><b>Valor Máximo / Compra Inmediata</b></p>
  <p><b>Créditos: </b><%= carta.CREDITOS_MAX %></p>
  <% if (carta.CARTAS_MAX !== null ) { %>
  <p><b>Cartas:</b></p>
  <ul class="cartas_v_max">
    <li><%= carta.CARTAS_MAX %></li>
  </ul>
  <% } %>
</div>
<div class="fechas_subasta">
  <p><b>Fecha de Inicio:</b> <%= carta.FECHA_INICIO%> </p>
  <p><b>Fecha Fin:</b> <%= carta.FECHA_FIN %></p>
  <p><b>Duración de la subasta:</b> <%= carta.TIEMPO %> horas</p>
</div>
<div class="tiempo_restante">
  <p id="timer_<%= i %>"></p>
</div>
</div>

<!-- Ofertas -->


<div class="ofertas">
<h2>Ofertas</h2>
<% if (pujas !== null ) { %>
  <div class="ofertas_jugadores_container">
  <% for (let j = 0; j < pujas.length; j++) { %>
  <div class="oferta_players">
    <p class="player_name"><b>@ShadowStriker</b></p>
    <p class="credits_player">Créditos: <%= pujas[j].CREDITOS %></p>
    <p class="cards_player">Cartas: <%= carta.Name %></p>
  </div>
  <% } %>
<% } else { %>
  <div class="oferta_players">
    <p class="no_pujas"><b>Aun no hay ofertas!</b></p>
  </div>
<% } %>




<div class="buttons">
  <button class="pujar" onclick="abrirPujar()"><b>Pujar</b></button>
  <button class="compra_rapida" onclick="abrirCompraRapida()" ><b>Compra rápida</b></button>
</div>
</div>

<!-- Emergente Puja-->
<div class="puja_container" >
  <label for="cantidad_creditos" class="c_creditos">
    Cantidad de créditos
  </label>
  <input type="number" name="cantidad_creditos" id="cantidad_creditos" oninput="validarNumero(this)">

  <% if (carta.CARTAS_MIN !== null ) { %>
  <label for="cards_puja">
    Cartas
  </label>
  <select name="cards_puja" id="cards_p">
    <option value="<%= carta.Name %>"><%= carta.Name %></option>
    <option value="">2</option>
    <option value="">3</option>
  </select>
  <% } %>
  <div class="buttons">
    <button class="pujar_b">Realizar puja</button>
    <button class="Cancelar" onclick="cerrarEmer()">Cancelar</button>
  </div>
</div>
<!--Compra rápida emergente-->
<div class="compra_rapida_container">
  <label for="cantidad_creditos" class="c_creditos">
    Cantidad de créditos
  </label>
  <input type="number" name="cantidad_creditos" oninput="validarNumero(this)" id="cantidad_creditos">

  <label for="cards">
    Cartas
  </label>
  <div class="cards_container">
    <p><%= carta.Name %></p>
  </div>
  <div class="buttons">
    <button class="comprar">Comprar</button>
    <button class="cancelar" onclick="cerrarEmer()">Cancelar</button>
  </div>
</div>

<% } %>
</main>
<script src="/subasta/js/emergentes.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    <% for (let i = 0; i < datos.length; i++) { %>
      const startDate_<%= i %> = new Date('<%= datos[i].TIEMPO_INICIO %>');

      const duration_<%= i %> = <%= datos[i].TIEMPO %> * 3600;

      function updateTimer_<%= i %>() {
        const now = new Date();

        const endTime = new Date(startDate_<%= i %>.getTime() + (duration_<%= i %> * 1000)); // Convertir la duración a milisegundos y sumarla a la fecha de inicio
        const timeLeft = Math.max(0, endTime - now); // Tiempo restante en milisegundos

        // Convertir el tiempo restante a horas, minutos y segundos
        const hours = Math.floor(timeLeft / (1000 * 60 * 60));
        const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);

        // Mostrar el temporizador en el elemento HTML
        document.getElementById('timer_<%= i %>').innerHTML = `<b>Tiempo restante: ${hours}h ${minutes}m ${seconds}s</b>`;

        // Si el tiempo restante es cero, detener el temporizador
        if (timeLeft === 0) {
            clearInterval(timerInterval_<%= i %>);
        }
      }

      // Actualizar el temporizador cada segundo
      const timerInterval_<%= i %> = setInterval(updateTimer_<%= i %>, 1000);

      // Actualizar el temporizador por primera vez
      updateTimer_<%= i %>();
    <% } %>
  });
</script>

</body>
</html>
